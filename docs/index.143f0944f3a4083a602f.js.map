{"version":3,"sources":["webpack://yandex-map-api/./src/templates/templates.js","webpack://yandex-map-api/./src/index.js"],"names":["formTemplate","ymaps","document","addEventListener","window","ready","init","clusterer","myMap","Map","center","zoom","controls","events","add","e","coords","get","openBalloon","Clusterer","clusterDisableClickZoom","options","set","renderGeoObject","geoObjectsInClusterer","getGeoObjects","getReviewsFromLS","reviews","localStorage","JSON","parse","getReviewList","currentGeoObjects","reviewListHTML","review","some","geoObject","stringify","geometry","_coordinates","place","author","reviewText","map","placemark","Placemark","stopPropagation","push","removeAll","geoObjects","remove","balloon","open","content","querySelector","preventDefault","this","elements","value","close"],"mappings":"mBAAO,IAAMA,EAAe,6hB,sUCM5B,IAAIC,EACJC,SAASC,iBAAiB,mBAAoB,KAC5CF,EAAQG,OAAOH,MACfA,EAAMI,MAAMC,KAGd,IAAIC,EAEJ,SAASD,IACP,IAAME,EAAQ,IAAIP,EAAMQ,IAAI,MAAO,CACjCC,OAAQ,CAAC,MAAO,OAChBC,KAAM,GACNC,SAAU,CAAC,iBAGbJ,EAAMK,OAAOC,IAAI,QAAS,SAAUC,GAClC,IAAMC,EAASD,EAAEE,IAAI,UAErBC,EAAYV,EAAOQ,EAAQ,MAE7BT,EAAY,IAAIN,EAAMkB,UAAU,CAAEC,wBAAyB,OAC3Db,EAAUc,QAAQC,IAAI,aAAc,OACpCC,EAAgBf,GAEhBD,EAAUM,OAAOC,IAAI,QAAS,SAAUC,GACtC,IAAMS,EAAwBT,EAAEE,IAAI,UAAUQ,gBAC9CP,EAAYV,EAAOO,EAAEE,IAAI,UAAWO,KAIxC,SAASE,IACP,IAAMC,EAAUC,aAAaD,QAC7B,OAAOE,KAAKC,MAAMH,GAAW,MAG/B,SAASI,EAAcC,GACrB,IAAIC,EAAiB,GADmB,iBAE7BC,GACT,GACEF,EAAkBG,KACfC,GACCP,KAAKQ,UAAUD,EAAUE,SAASC,gBAClCV,KAAKQ,UAAUH,EAAOlB,SAE1B,CACAiB,GAAkB,sEAAJ,OAEmBC,EAAOM,MAF1B,sDAGiBN,EAAOO,OAHxB,4EAIuCP,EAAOQ,WAJ9C,kCARlB,IAAK,IAAMR,KAAUR,IAAoB,GAA9BQ,GAiBX,OAAOD,EAGT,SAASV,EAAgBoB,GACvB,IAAMP,EAAY,GADU,iBAEjBF,GACT,IAAMU,EAAY,IAAI3C,EAAM4C,UAAUX,EAAOlB,QAC7C4B,EAAU/B,OAAOC,IAAI,QAAUC,IAC7BA,EAAE+B,kBACF5B,EAAYyB,EAAKT,EAAOlB,OAAQ,CAACD,EAAEE,IAAI,cAEzCmB,EAAUW,KAAKH,IANjB,IAAK,IAAMV,KAAUR,IAAoB,GAA9BQ,GAQX3B,EAAUyC,YACVL,EAAIM,WAAWC,OAAO3C,GACtBA,EAAUO,IAAIsB,GACdO,EAAIM,WAAWnC,IAAIP,G,SAGNW,E,uDAAf,UAA2ByB,EAAK3B,EAAQgB,SAChCW,EAAIQ,QAAQC,KAAKpC,EAAQ,CAC7BqC,QACE,+BAAwBtB,EAAcC,GAAtC,UAAmEhC,IAEvEE,SAASoD,cAAc,aAAanD,iBAAiB,SAAU,SAAUY,GACvEA,EAAEwC,iBACF,IAAMrB,EAAS,CACblB,OAAQA,EACRyB,OAAQe,KAAKC,SAAShB,OAAOiB,MAC7BlB,MAAOgB,KAAKC,SAASjB,MAAMkB,MAC3BhB,WAAYc,KAAKC,SAASvB,OAAOwB,OAEnC9B,aAAaD,QAAUE,KAAKQ,UAAU,IAAIX,IAAoBQ,IAE9DX,EAAgBoB,GAEhBA,EAAIQ,QAAQQ,Y","file":"index.143f0944f3a4083a602f.js","sourcesContent":["export const formTemplate = `\r\n<form id=\"add-form\" class=\"form\">\r\n  <h3 class=\"form__title\">Отзыв:</h3>\r\n  <div class=\"form__row\">\r\n    <input type=\"text\" placeholder=\"Укажите ваше имя\" name=\"author\" class=\"form__input\">\r\n  </div>\r\n  <div class=\"form__row\">\r\n    <input type=\"text\" placeholder=\"Укажите место\" name=\"place\" class=\"form__input\">\r\n  </div>\r\n  <div class=\"form__row\">\r\n    <textarea placeholder=\"Оставить отзыв\" name=\"review\" class=\"form__input form__input--textarea\"></textarea>\r\n  </div>\r\n  <button id=\"add-btn\" class=\"btn\">Добавить</button>\r\n</form>\r\n`;\r\n","import './styles/main.css';\r\nimport { formTemplate } from './templates/templates.js';\r\n\r\n// const ymaps = window.ymaps;\r\n// document.addEventListener('DOMContentLoaded', () => ymaps.ready(init));\r\n\r\nlet ymaps;\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  ymaps = window.ymaps;\r\n  ymaps.ready(init);\r\n});\r\n\r\nlet clusterer;\r\n\r\nfunction init() {\r\n  const myMap = new ymaps.Map('map', {\r\n    center: [55.76, 37.64],\r\n    zoom: 12,\r\n    controls: ['zoomControl'],\r\n    // behaviors: ['drag']\r\n  });\r\n  myMap.events.add('click', function (e) {\r\n    const coords = e.get('coords');\r\n\r\n    openBalloon(myMap, coords, []);\r\n  });\r\n  clusterer = new ymaps.Clusterer({ clusterDisableClickZoom: true });\r\n  clusterer.options.set('hasBalloon', false);\r\n  renderGeoObject(myMap);\r\n\r\n  clusterer.events.add('click', function (e) {\r\n    const geoObjectsInClusterer = e.get('target').getGeoObjects();\r\n    openBalloon(myMap, e.get('coords'), geoObjectsInClusterer);\r\n  });\r\n}\r\n\r\nfunction getReviewsFromLS() {\r\n  const reviews = localStorage.reviews;\r\n  return JSON.parse(reviews || '[]');\r\n}\r\n\r\nfunction getReviewList(currentGeoObjects) {\r\n  let reviewListHTML = '';\r\n  for (const review of getReviewsFromLS()) {\r\n    if (\r\n      currentGeoObjects.some(\r\n        (geoObject) =>\r\n          JSON.stringify(geoObject.geometry._coordinates) ===\r\n          JSON.stringify(review.coords)\r\n      )\r\n    ) {\r\n      reviewListHTML += `\r\n      <div class=\"review\">\r\n        <div><strong>Место: </strong>${review.place}</div>\r\n        <div><strong>Имя: </strong>${review.author}</div>\r\n        <div class=\"review-text\"><strong>Отзыв: </strong>${review.reviewText}</div>\r\n      </div>\r\n      `;\r\n    }\r\n  }\r\n  return reviewListHTML;\r\n}\r\n\r\nfunction renderGeoObject(map) {\r\n  const geoObject = [];\r\n  for (const review of getReviewsFromLS()) {\r\n    const placemark = new ymaps.Placemark(review.coords);\r\n    placemark.events.add('click', (e) => {\r\n      e.stopPropagation();\r\n      openBalloon(map, review.coords, [e.get('target')]);\r\n    });\r\n    geoObject.push(placemark);\r\n  }\r\n  clusterer.removeAll();\r\n  map.geoObjects.remove(clusterer);\r\n  clusterer.add(geoObject);\r\n  map.geoObjects.add(clusterer);\r\n}\r\n\r\nasync function openBalloon(map, coords, currentGeoObjects) {\r\n  await map.balloon.open(coords, {\r\n    content:\r\n      `<div class=\"reviews\">${getReviewList(currentGeoObjects)}</div>` + formTemplate,\r\n  });\r\n  document.querySelector('#add-form').addEventListener('submit', function (e) {\r\n    e.preventDefault();\r\n    const review = {\r\n      coords: coords,\r\n      author: this.elements.author.value,\r\n      place: this.elements.place.value,\r\n      reviewText: this.elements.review.value,\r\n    };\r\n    localStorage.reviews = JSON.stringify([...getReviewsFromLS(), review]);\r\n\r\n    renderGeoObject(map);\r\n\r\n    map.balloon.close();\r\n  });\r\n}\r\n"],"sourceRoot":""}